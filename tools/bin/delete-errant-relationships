#!/bin/bash
set -euo pipefail 

[ -f .env ] && source .env
[ ! -f results.json ] && J1_DEV_ENABLED=true yarn j1 -a j1dev -k "$J1_API_TOKEN" \
  -q "Find (Function|Task|Workload) THAT (EXECUTES|ACCESSES) as rx (Function|Task|Workload|Database) WHERE rx.hackathon2021 = undefined
  RETURN
  rx._id as _id,
  rx._type as type"

# create bulkDelete.json
node ./tools/bin/mapids.js

J1_DEV_ENABLED=true yarn j1 -a j1dev -k "$J1_API_TOKEN" -o bulk-delete --relationship -f ./bulkDelete.json 

rm results.json bulkDelete.json